angular.module("App",["ngRoute","ngResource","ngAnimate","ngCookies","ui.router"]).config(["$routeProvider","$stateProvider","$urlRouterProvider",function(e,o,r){o.state("home",{url:"/",templateUrl:"../templates/home.html",controller:"HomeCtrl"}).state("login",{url:"/login",templateUrl:"../templates/login.html",controller:"LoginCtrl"}).state("register",{url:"/register",templateUrl:"../templates/register.html",controller:"RegisterCtrl"}),r.otherwise("/")}]),angular.module("App").controller("HomeCtrl",["$scope","$location","UserFactory","ImageDataFactory",function(e,o,r,t){console.log("Home Controller Loaded"),t.initialize(),$("#releasable-image").mousemove(function(e){var o=t.getMetaData(e.offsetX,e.offsetY);if(!o)return void $("#image-tooltip").popover("hide");var r=o.buyer.id.firstname,n=o.message;$("#image-tooltip").attr("data-original-title",r+" said:").attr("data-content",n).css({position:"absolute",top:e.pageY-25+"px",left:e.offsetX+125+"px"}).popover("show")}),e.isLoggedIn=r.isLoggedIn,e.userName=r.me.firstname?r.me.firstname:"",e.logout=function(){r.logout(function(o){return o?console.error(o):void(e.isLoggedIn=r.isLoggedIn)})},r.makeMeRequest(function(o){return o?console.error(o):(e.userName=r.me.firstname?r.me.firstname:"",void(e.isLoggedIn=r.isLoggedIn))}),$(document).ready(function(){$("#about-slider").slideUp("fast"),$("#buy-slider").slideUp("fast")});var n=!1,s=!1;e.showAbout=function(){console.log("showing about!"),n=!n,n?s?$("#buy-slider").slideUp("fast",function(){s=!1,$("#about-slider").slideDown("slow")}):$("#about-slider").slideDown("slow"):$("#about-slider").slideUp("slow")},e.showBuy=function(){return r.isLoggedIn?(s=!s,void(s?n?$("#about-slider").slideUp("fast",function(){n=!1,$("#buy-slider").slideDown("slow")}):$("#buy-slider").slideDown("slow"):$("#buy-slider").slideUp("slow"))):void o.path("/login")}}]),angular.module("App").controller("LoginCtrl",["$scope","$state","UserFactory",function(e,o,r){console.log("Login Controller Added"),e.email="",e.password="",e.errorMessage="",e.login=function(){e.errorMessage="",r.login(e.email,e.password,function(r){return r?(e.errorMessage=r,void console.error(r)):void o.go("home")})}}]),angular.module("App").controller("RegisterCtrl",["$scope","$state","UserFactory",function(e,o,r){console.log("Register Controller Added"),e.errorMessage="",e.user={firstname:"",lastname:"",email:"",password:"",confirmPassword:""},$("#register-success-modal").on("hidden.bs.modal",function(){console.log("modal is hidden!"),o.go("home")}),e.doRegister=function(){return console.log("Signing up!"),e.errorMessage="",0===e.user.firstname.length||0===e.user.lastname.length||0===e.user.email.length||0===e.user.password.length||0===e.user.confirmPassword.length?void(e.errorMessage="Ensure every field is filled out!"):e.user.password!==e.user.confirmPassword?(console.error("passwords dont match!"),void(e.errorMessage="Your passwords do not match! Please try again.")):void r.register(e.user,function(o,t){return o?(console.log(o),void(e.errorMessage=o.error)):(console.log(t),r.login(e.user.email,e.user.password,function(e){e&&(console.error("I just registered you, and I couldn't log you in!"),console.log(e))}),void $("#register-success-modal").modal("show"))})}}]),angular.module("App").directive("aboutSlide",[function(){return{templateUrl:"../../templates/about.html",restrict:"E"}}]),angular.module("App").directive("buySlide",[function(){return{templateUrl:"../../templates/buy.html",restrict:"E"}}]),angular.module("App").factory("ImageDataFactory",["$http",function(e){var o={pixelInfo:null,initialize:function(){null===o.pixelInfo&&(o.pixelInfo=[],e.get("/api/pixels").success(function(e){var r={};e.forEach(function(e){r[Number(e.pixel.x)]||(r[Number(e.pixel.x)]={}),r[Number(e.pixel.x)][Number(e.pixel.y)]=e}),o.pixelInfo=r}))},getMetaData:function(e,r){return o.pixelInfo[e]&&o.pixelInfo[e][r]?o.pixelInfo[Number(e)][Number(r)]:void 0}};return o}]),angular.module("App").factory("PaypalFactory",["$http",function(e){return{}}]),angular.module("App").factory("UserFactory",["$http",function(e){console.log("Initializing User Factory!");var o={me:{},isLoggedIn:!1,login:function(o,r,t){var n=this;e({method:"POST",url:"/api/login",headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){var o=[];for(var r in e)o.push(encodeURIComponent(r)+"="+encodeURIComponent(e[r]));return o.join("&")},data:{email:o,password:r}}).success(function(e){return console.log("SUCCESS"),console.log(e),e.isLoggedIn?void n.makeMeRequest(t):t("Invalid email and password combo.")}).error(function(e){console.log("ERROR"),console.log(e)})},logout:function(o){var r=this;e.get("/api/logout").success(function(e){r.isLoggedIn=e.isLoggedIn,console.log(e),o(null)}).error(function(e){o(e)})},makeMeRequest:function(o){var r=this;e.get("/api/me").success(function(e){e.error?(console.log(e.error),o(e.error)):(r.me=e.me,r.isLoggedIn=!0,console.log("Just made me request and u are logged in"),o(null))}).error(function(e){console.log(e),o(e)})},register:function(o,r){e.post("/api/user",{user:o},{headers:{"Content-Type":"application/json"}}).then(function(e){console.log(e),r(null,e)},function(e){console.error(e),r(e.data)})}};return o}]);